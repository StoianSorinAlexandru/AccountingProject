@page "/entries"
@using ProiectConta.Entries
@using ProiectConta.Gestions
@using ProiectConta.Localization
@using ProiectConta.Partners
@using Volo.Abp.AspNetCore.Components.Web
@inherits ProiectContaComponentBase
@inject IEntryAppService EntryAppService
@inject IGestionAppService GestionAppService
@inject IPartnerAppService PartnerAppService
@inject AbpBlazorMessageLocalizerHelper<ProiectContaResource> LH

<Card>
	<CardHeader>
		<Row Class="justify-content-between">
			<Column ColumnSize="ColumnSize.IsAuto">
				<h2>@L["Entries"]</h2>
			</Column>
			<Column ColumnSize="ColumnSize.IsAuto">
				<Button Color="Color.Primary" Clicked="OpenCreateEntryModal">
					@L["AddEntry"]
				</Button>
			</Column>
		</Row>
	</CardHeader>

	<CardBody>
		<DataGrid TItem="EntryDto"
				  Data="EntryList"
				  TotalItems="TotalCount"
				  ShowPager="true"
				  PageSize="PageSize">
			<DataGridColumns>
				<DataGridColumn
					TItem="EntryDto"
					Caption="@L["Actions"]"
					Field="@nameof(EntryDto.Id)">
					<DisplayTemplate>
						<Dropdown>
							<DropdownToggle Color="Color.Primary">
								@L["Actions"]
							</DropdownToggle>
							<DropdownMenu>
								<DropdownItem Clicked="() => OpenEditEntryModal(context)">
									@L["Edit"]
								</DropdownItem>
								<DropdownItem Clicked="() => DeleteEntryAsync(context)">
									@L["Delete"]
								</DropdownItem>
							</DropdownMenu>
						</Dropdown>
					</DisplayTemplate>
				</DataGridColumn>
				<DataGridColumn TItem="EntryDto" Field="@nameof(EntryDto.Date)" Caption="@L["Date"]" />
				<DataGridColumn TItem="EntryDto" Field="@nameof(EntryDto.PartnerName)" Caption="@L["PartnerName"]" />
				<DataGridColumn TItem="EntryDto" Field="@nameof(EntryDto.GestionName)" Caption="@L["GestionName"]" />

			</DataGridColumns>
		</DataGrid>			
	</CardBody>

</Card>

<Modal Animated="true" @ref="CreateEntryModal">
	<ModalContent IsCentered="true">
		<Form>
			<ModalHeader>
				<ModalTitle>@L["AddEntry"]</ModalTitle>
				<CloseButton Clicked="CloseCreateEntryModal" />
			</ModalHeader>
			<ModalBody>
				 <div>
					<label>Partner:</label>
					<Select @bind-Text="NewEntry.PartnerName" TItem="string" TValue="string">
						@foreach (var partner in PartnerList)
						{
							<Option Value="@partner">@partner</Option>
						}
					</Select>
				</div>
				<div>
					<label>Gestion:</label>
					<Select @bind-Text="NewEntry.GestionName" TItem="string" TValue="string">
						@foreach (var gestion in GestionList)
						{
							<Option Value="@gestion">@gestion</Option>
						}
					</Select>
				</div>
				<Field>
					<FieldLabel>@L["Date"]</FieldLabel>
					<DateEdit @bind-Date="@NewEntry.Date" DefaultDate="@DateTime.Now" />
				</Field>

			</ModalBody>
			<ModalFooter>
				<Button Color="Color.Primary" Type="@ButtonType.Submit" Clicked="CreateEntryAsync">@L["Save"]</Button>
				<Button Color="Color.Secondary" Type="@ButtonType.Submit" Clicked="CloseCreateEntryModal">@L["Cancel"]</Button>
			</ModalFooter>
		</Form>
	</ModalContent>
</Modal>

<Modal Animated="true" @ref="EditEntryModal">
	<ModalContent IsCentered="true">
		<Form>
			<ModalHeader>
				<ModalTitle>@L["EditEntry"]</ModalTitle>
				<CloseButton Clicked="CloseEditEntryModal" />
			</ModalHeader>
			<ModalBody>
				<Field>
                    <div>
						<label>Partner:</label>
						<Select @bind-Text="EditingEntry.PartnerName" TItem="string" TValue="string">
							@foreach (var partner in PartnerList)
							{
								<Option Value="@partner">@partner</Option>
							}
						</Select>
					</div>
					<div>
						<label>Gestion:</label>
						<Select @bind-Text="EditingEntry.GestionName" TItem="string" TValue="string">
							@foreach (var gestion in GestionList)
							{
								<Option Value="@gestion">@gestion</Option>
							}
						</Select>
                    </div>
				</Field>
				<Field>
                    <FieldLabel>@L["Date"]</FieldLabel>
                    <DateEdit @bind-Date="@EditingEntry.Date" DefaultDate="@DateTime.Now"/>
				</Field>

			</ModalBody>
			<ModalFooter>
				<Button Color="Color.Primary" Type="@ButtonType.Submit" Clicked="UpdateEntryAsync">@L["Save"]</Button>
				<Button Color="Color.Secondary" Type="@ButtonType.Submit" Clicked="CloseEditEntryModal">@L["Cancel"]</Button>
			</ModalFooter>
		</Form>
	</ModalContent>
</Modal>